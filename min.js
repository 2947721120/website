!function(e){function r(e){var r,a=document,o=e;if(a.body.createTextRange)r=a.body.createTextRange(),r.moveToElementText(o),r.select();else if(window.getSelection){var t=window.getSelection();r=a.createRange(),r.selectNodeContents(o),t.removeAllRanges(),t.addRange(r)}}function a(){e("#name").text(i.login),t(n),e("body").addClass("authenticated"),e(".login-box").hide(),e(".logged-in").show()}function o(e){UserApp.User.get({user_id:"self"},function(r,a){r?e&&e(null):e&&e(a[0])})}function t(r){e.get("http://cdnjs-server.herokuapp.com/favorites?token="+u,function(e){e&&(d=e,r(e))},"json")}function n(r){_.each(r,function(r){r="#"+r;var a=e(r),o=a.clone(!0);a.remove(),o.addClass("favorite"),e("#example tbody").prepend(o)})}function c(e,r){var a=[],o=e.length,t=r.length;if(0==o)return t;if(0==t)return o;for(var n=o;n>=0;n--)a[n]=[];for(var n=o;n>=0;n--)a[n][0]=n;for(var c=t;c>=0;c--)a[0][c]=c;for(var n=1;o>=n;n++)for(var l=e.charAt(n-1),c=1;t>=c;c++){if(n==c&&a[n][c]>4)return o;var s=r.charAt(c-1),i=l==s?0:1,u=a[n-1][c]+1,d=a[n][c-1]+1,h=a[n-1][c-1]+i;u>d&&(u=d),u>h&&(u=h),a[n][c]=u,n>1&&c>1&&l==r.charAt(c-2)&&e.charAt(n-2)==s&&(a[n][c]=Math.min(a[n][c],a[n-2][c-2]+i))}return a[o][t]}function l(r){if($rowCache=$rowCache||e(rowSelector),r.length>0){var a=[];cleanSearchVal=r.replace(/\./g,"").toLowerCase();for(var o=0;o<libraryNameCache.length;o++){var t=libraryNameCache[o];e("#"+t);var n=c(t,r),l=-1!==t.toLowerCase().indexOf(cleanSearchVal),s=_.contains(d,t);(l||2>n)&&a.push({name:t,levDist:n,favorite:s})}a=_.sortBy(a,function(e){var r=e.favorite?-1e3:0;return r+e.levDist}),e(matchedRowSelector).empty(),$rowCache.hide();for(var i=0;i<a.length;i++){var u=a[i],h=_.findWhere($rowCache,{id:u.name}),f=e(h).clone(!0).show();f.addClass("search-result"),e("#example tbody").append(f)}}else e(matchedRowSelector).empty(),$rowCache.show()}function s(r){var a=e(r.currentTarget).val();l(a)}UserApp.initialize({appId:"5343d12871774"});var i=null,u=Kaka.get("ua_session_token");u&&(UserApp.setToken(u),o(function(e){e&&(console.log(e),i=e,a())})),window.logout=function(){Kaka.remove("ua_session_token"),UserApp.User.logout(function(){window.location.href="login.html"})};var d=[];e("#example .change-favorite").on("click",function(r){var a=e(r.currentTarget).parents("tr")[0].id;_.contains(d,a)?_.isArray(d)&&d.length>0&&(_gaq.push(["_trackEvent","favorite","removed",a]),d=_.without(d,a),e.ajax({url:"http://cdnjs-server.herokuapp.com/favorites?token="+u,success:function(){console.log(arguments)},type:"DELETE",data:{library:a}})):(d.push(a),_gaq.push(["_trackEvent","favorite","added",a]),e.ajax({url:"http://cdnjs-server.herokuapp.com/favorites?token="+u,success:function(){console.log(arguments)},type:"POST",data:{library:a}}));var o=e("#"+a),t=o.clone(!0);o.hasClass("favorite")?(t.removeClass("favorite"),o.remove(),e("#example tbody").append(t)):(t.addClass("favorite"),o.remove(),e("#example tbody").prepend(t))}),e("p.library-url").on("mouseenter",function(a){r(e(a.currentTarget)[0])}),rowSelector="#example > tbody > tr",matchedRowSelector="#example tr.search-result",libraryNameCache=_.pluck(e(rowSelector),"id"),$rowCache=null,e("#search-box").on("keyup",_.debounce(s,300)),e("#search-box").focus()}(jQuery);