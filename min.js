!function(e){function r(e){var r,o=document,a=e;if(o.body.createTextRange)r=o.body.createTextRange(),r.moveToElementText(a),r.select();else if(window.getSelection){var t=window.getSelection();r=o.createRange(),r.selectNodeContents(a),t.removeAllRanges(),t.addRange(r)}}function o(){e("#name").text(i.login),t(n),e("body").addClass("authenticated"),e(".login-box").hide(),e(".logged-in").show()}function a(e){UserApp.User.get({user_id:"self"},function(r,o){r?e&&e(null):e&&e(o[0])})}function t(r){e.get("http://cdnjs-server.herokuapp.com/favorites?token="+u,function(e){e&&(d=e,r(e))},"json")}function n(r){_.each(r,function(r){r="#"+r;var o=e(r),a=o.clone(!0);o.remove(),a.addClass("favorite"),e("#example tbody").prepend(a)})}function c(e,r){var o=[],a=e.length,t=r.length;if(0==a)return t;if(0==t)return a;for(var n=a;n>=0;n--)o[n]=[];for(var n=a;n>=0;n--)o[n][0]=n;for(var c=t;c>=0;c--)o[0][c]=c;for(var n=1;a>=n;n++)for(var l=e.charAt(n-1),c=1;t>=c;c++){if(n==c&&o[n][c]>4)return a;var s=r.charAt(c-1),i=l==s?0:1,u=o[n-1][c]+1,d=o[n][c-1]+1,f=o[n-1][c-1]+i;u>d&&(u=d),u>f&&(u=f),o[n][c]=u,n>1&&c>1&&l==r.charAt(c-2)&&e.charAt(n-2)==s&&(o[n][c]=Math.min(o[n][c],o[n-2][c-2]+i))}return o[a][t]}function l(r){if(e(rowSelector).removeClass("search-result"),r.length>0){var o=[];cleanSearchVal=r.replace(/\./g,"").toLowerCase();for(var a=0;a<libraryNameCache.length;a++){var t=libraryNameCache[a];e("#"+t);var l=c(t,r),s=-1!==t.toLowerCase().indexOf(cleanSearchVal),i=_.contains(d,t);"jquery"===t&&console.log(l),(s||2>l)&&("jquery"===t&&console.log("made it"),o.push({name:t,levDist:l,favorite:i}))}o=_.sortBy(o,function(e){var r=e.favorite?-1e3:0;return r+e.levDist}),e(rowSelector).hide();for(var u=o.length;u>0;u--){var f=o[u-1],v=_.findWhere(e(rowSelector),{id:f.name});e(v).addClass("search-result"),e(v).prependTo("#example > tbody")}e(matchedRowSelector).show()}else e(rowSelector).show(),n(d)}function s(r){var o=e(r.currentTarget).val();l(o)}UserApp.initialize({appId:"5343d12871774"});var i=null,u=Kaka.get("ua_session_token");u&&(UserApp.setToken(u),a(function(e){e&&(console.log(e),i=e,o())})),window.logout=function(){Kaka.remove("ua_session_token"),UserApp.User.logout(function(){window.location.href="login.html"})};var d=[];e("#example .change-favorite").on("click",function(r){var o=e(r.currentTarget).parents("tr")[0].id;_.contains(d,o)?_.isArray(d)&&d.length>0&&(_gaq.push(["_trackEvent","favorite","removed",o]),d=_.without(d,o),e.ajax({url:"http://cdnjs-server.herokuapp.com/favorites?token="+u,success:function(){console.log(arguments)},type:"DELETE",data:{library:o}})):(d.push(o),_gaq.push(["_trackEvent","favorite","added",o]),e.ajax({url:"http://cdnjs-server.herokuapp.com/favorites?token="+u,success:function(){console.log(arguments)},type:"POST",data:{library:o}}));var a=e("#"+o);console.log(a),a.hasClass("favorite")?(e(a).appendTo("#example tbody"),a.removeClass("favorite")):(window.a=a,a.addClass("favorite"),e(a).prependTo("#example tbody"))}),e("p.library-url").on("mouseenter",function(o){r(e(o.currentTarget)[0])}),rowSelector="#example > tbody > tr",matchedRowSelector="#example tr.search-result",libraryNameCache=_.pluck(e(rowSelector),"id"),e("#search-box").on("keyup",_.debounce(s,300)),e("#search-box").focus()}(jQuery);